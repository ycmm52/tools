<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistics & Visualization | Tools</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        :root {
            --ctp-base: #1e1e2e;
            --ctp-mantle: #181825;
            --ctp-crust: #11111b;
            --ctp-text: #cdd6f4;
            --ctp-subtext0: #a6adc8;
            --ctp-subtext1: #bac2de;
            --ctp-surface0: #313244;
            --ctp-surface1: #45475a;
            --ctp-surface2: #585b70;
            --ctp-overlay0: #6c7086;
            --ctp-blue: #89b4fa;
            --ctp-lavender: #b4befe;
            --ctp-sapphire: #74c7ec;
            --ctp-sky: #89dceb;
            --ctp-teal: #94e2d5;
            --ctp-green: #a6e3a1;
            --ctp-yellow: #f9e2af;
            --ctp-peach: #fab387;
            --ctp-mauve: #cba6f7;
            --ctp-pink: #f5c2e7;
            --ctp-red: #f38ba8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--ctp-base);
            color: var(--ctp-text);
            min-height: 100vh;
        }

        header {
            background: var(--ctp-mantle);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--ctp-surface0);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            font-size: 1.25rem;
            color: var(--ctp-mauve);
        }

        .back-link {
            color: var(--ctp-subtext0);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .back-link:hover {
            color: var(--ctp-sapphire);
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 2rem;
        }

        .input-section {
            margin-bottom: 2rem;
        }

        label {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--ctp-subtext0);
            margin-bottom: 0.5rem;
        }

        textarea {
            width: 100%;
            min-height: 100px;
            background: var(--ctp-surface0);
            border: 1px solid var(--ctp-surface1);
            border-radius: 8px;
            padding: 1rem;
            color: var(--ctp-text);
            font-family: "SF Mono", "Fira Code", "Consolas", monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s;
        }

        textarea:focus {
            border-color: var(--ctp-mauve);
        }

        .hint {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: var(--ctp-overlay0);
        }

        .btn-row {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        button {
            background: linear-gradient(135deg, var(--ctp-mauve), var(--ctp-pink));
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            color: var(--ctp-crust);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(203, 166, 247, 0.3);
        }

        button.secondary {
            background: var(--ctp-surface0);
            color: var(--ctp-text);
        }

        button.secondary:hover {
            background: var(--ctp-surface1);
            box-shadow: none;
        }

        .error {
            color: var(--ctp-red);
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--ctp-mantle);
            border: 1px solid var(--ctp-surface0);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            transition: transform 0.2s, border-color 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: var(--ctp-surface1);
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--ctp-lavender);
            font-family: "SF Mono", "Fira Code", "Consolas", monospace;
        }

        .stat-label {
            margin-top: 0.35rem;
            font-size: 0.7rem;
            color: var(--ctp-subtext0);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-card.primary .stat-value {
            color: var(--ctp-green);
        }

        .stat-card.secondary .stat-value {
            color: var(--ctp-peach);
        }

        /* Charts */
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        .chart-card {
            background: var(--ctp-mantle);
            border: 1px solid var(--ctp-surface0);
            border-radius: 12px;
            padding: 1rem;
        }

        .chart-card h3 {
            font-size: 0.8rem;
            color: var(--ctp-subtext0);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
        }

        .chart-placeholder {
            height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--ctp-overlay0);
            font-size: 0.9rem;
        }
    </style>
</head>

<body>
    <header>
        <h1>üìä Statistics & Visualization</h1>
        <a href="../" class="back-link">‚Üê Back to Tools</a>
    </header>

    <div class="container">
        <div class="input-section">
            <label>Enter Numbers</label>
            <textarea id="dataInput"
                placeholder="Enter numbers separated by commas, spaces, or newlines...">23, 45, 67, 12, 89, 34, 56, 78, 90, 21, 43, 65, 87, 32, 54, 76, 98, 11, 33, 55, 77, 99, 22, 44, 66, 88, 15, 35, 57, 79</textarea>
            <div class="hint">Accepts comma-separated, space-separated, or one number per line. Press Ctrl+Enter to
                calculate.</div>
            <div class="btn-row">
                <button id="calculateBtn">Calculate & Plot</button>
                <button id="sampleBtn" class="secondary">Load Sample Data</button>
            </div>
            <div id="error" class="error"></div>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card primary">
                <div class="stat-value" id="mean">‚Äî</div>
                <div class="stat-label">Mean</div>
            </div>
            <div class="stat-card primary">
                <div class="stat-value" id="median">‚Äî</div>
                <div class="stat-label">Median</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="mode">‚Äî</div>
                <div class="stat-label">Mode</div>
            </div>
            <div class="stat-card secondary">
                <div class="stat-value" id="stdev">‚Äî</div>
                <div class="stat-label">Std Dev</div>
            </div>
            <div class="stat-card secondary">
                <div class="stat-value" id="variance">‚Äî</div>
                <div class="stat-label">Variance</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="min">‚Äî</div>
                <div class="stat-label">Min</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="max">‚Äî</div>
                <div class="stat-label">Max</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="q1">‚Äî</div>
                <div class="stat-label">Q1 (25%)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="q3">‚Äî</div>
                <div class="stat-label">Q3 (75%)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="count">‚Äî</div>
                <div class="stat-label">Count</div>
            </div>
        </div>

        <!-- Charts -->
        <div class="charts-container">
            <div class="chart-card">
                <h3>Distribution Histogram</h3>
                <div id="histogramChart">
                    <div class="chart-placeholder">Enter data and click Calculate</div>
                </div>
            </div>
            <div class="chart-card">
                <h3>Box Plot</h3>
                <div id="boxChart">
                    <div class="chart-placeholder">Enter data and click Calculate</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const calculateBtn = document.getElementById('calculateBtn');
        const sampleBtn = document.getElementById('sampleBtn');
        const dataInput = document.getElementById('dataInput');
        const errorEl = document.getElementById('error');

        // Plotly theme matching Catppuccin Mocha
        const plotlyLayout = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#cdd6f4', family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto' },
            margin: { t: 20, r: 20, b: 40, l: 50 },
            xaxis: { gridcolor: '#313244', zerolinecolor: '#45475a' },
            yaxis: { gridcolor: '#313244', zerolinecolor: '#45475a' }
        };

        const plotlyConfig = { responsive: true, displayModeBar: false };

        // ============ Statistics Functions (Pure JS) ============
        function mean(arr) {
            return arr.reduce((a, b) => a + b, 0) / arr.length;
        }

        function median(arr) {
            const sorted = [...arr].sort((a, b) => a - b);
            const mid = Math.floor(sorted.length / 2);
            return sorted.length % 2 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;
        }

        function mode(arr) {
            const freq = {};
            let maxFreq = 0;
            let modes = [];

            arr.forEach(val => {
                freq[val] = (freq[val] || 0) + 1;
                if (freq[val] > maxFreq) {
                    maxFreq = freq[val];
                    modes = [val];
                } else if (freq[val] === maxFreq && !modes.includes(val)) {
                    modes.push(val);
                }
            });

            // If all values appear once, there's no mode
            if (maxFreq === 1) return null;
            return modes.length === 1 ? modes[0] : modes;
        }

        function variance(arr) {
            const m = mean(arr);
            return arr.reduce((sum, val) => sum + Math.pow(val - m, 2), 0) / (arr.length - 1);
        }

        function stdev(arr) {
            return Math.sqrt(variance(arr));
        }

        function quantile(arr, q) {
            const sorted = [...arr].sort((a, b) => a - b);
            const pos = (sorted.length - 1) * q;
            const base = Math.floor(pos);
            const rest = pos - base;

            if (sorted[base + 1] !== undefined) {
                return sorted[base] + rest * (sorted[base + 1] - sorted[base]);
            } else {
                return sorted[base];
            }
        }

        // ============ Main Calculation ============
        function formatNumber(num) {
            if (num === null || num === undefined) return '‚Äî';
            if (Array.isArray(num)) return num.map(n => n.toLocaleString()).join(', ');
            if (Number.isInteger(num)) return num.toLocaleString();
            return num.toFixed(2);
        }

        function parseInput() {
            const rawInput = dataInput.value.trim();
            if (!rawInput) return null;

            return rawInput
                .split(/[\s,\n]+/)
                .map(s => s.trim())
                .filter(s => s !== '')
                .map(Number)
                .filter(n => !isNaN(n));
        }

        function calculate() {
            errorEl.textContent = '';
            const numbers = parseInput();

            if (!numbers || numbers.length === 0) {
                errorEl.textContent = 'Please enter some valid numbers';
                return;
            }

            if (numbers.length < 2) {
                errorEl.textContent = 'Please enter at least 2 numbers';
                return;
            }

            // Calculate all stats
            const stats = {
                mean: mean(numbers),
                median: median(numbers),
                mode: mode(numbers),
                stdev: stdev(numbers),
                variance: variance(numbers),
                min: Math.min(...numbers),
                max: Math.max(...numbers),
                q1: quantile(numbers, 0.25),
                q3: quantile(numbers, 0.75),
                count: numbers.length
            };

            // Update stat cards
            document.getElementById('mean').textContent = formatNumber(stats.mean);
            document.getElementById('median').textContent = formatNumber(stats.median);
            document.getElementById('mode').textContent = stats.mode !== null ? formatNumber(stats.mode) : 'N/A';
            document.getElementById('stdev').textContent = formatNumber(stats.stdev);
            document.getElementById('variance').textContent = formatNumber(stats.variance);
            document.getElementById('min').textContent = formatNumber(stats.min);
            document.getElementById('max').textContent = formatNumber(stats.max);
            document.getElementById('q1').textContent = formatNumber(stats.q1);
            document.getElementById('q3').textContent = formatNumber(stats.q3);
            document.getElementById('count').textContent = stats.count;

            // Draw Histogram
            Plotly.newPlot('histogramChart', [{
                x: numbers,
                type: 'histogram',
                marker: {
                    color: '#cba6f7',
                    line: { color: '#1e1e2e', width: 1 }
                },
                opacity: 0.85
            }], {
                ...plotlyLayout,
                xaxis: { ...plotlyLayout.xaxis, title: 'Value' },
                yaxis: { ...plotlyLayout.yaxis, title: 'Frequency' },
                bargap: 0.05
            }, plotlyConfig);

            // Draw Box Plot
            Plotly.newPlot('boxChart', [{
                y: numbers,
                type: 'box',
                marker: { color: '#89b4fa' },
                line: { color: '#b4befe' },
                fillcolor: 'rgba(137, 180, 250, 0.3)',
                boxpoints: 'outliers',
                jitter: 0.3
            }], {
                ...plotlyLayout,
                yaxis: { ...plotlyLayout.yaxis, title: 'Value' }
            }, plotlyConfig);
        }

        // Sample datasets
        const sampleDatasets = [
            '23, 45, 67, 12, 89, 34, 56, 78, 90, 21, 43, 65, 87, 32, 54, 76, 98, 11, 33, 55',
            '150, 155, 160, 162, 165, 168, 170, 172, 175, 178, 180, 182, 185, 188, 190, 192',
            '2.5, 3.1, 2.8, 3.5, 4.2, 3.8, 2.9, 3.3, 4.0, 3.7, 2.6, 3.9, 4.1, 3.0, 3.4',
            '100, 200, 150, 300, 180, 220, 190, 250, 170, 280, 160, 240, 210, 270, 230'
        ];
        let sampleIndex = 0;

        sampleBtn.addEventListener('click', () => {
            dataInput.value = sampleDatasets[sampleIndex];
            sampleIndex = (sampleIndex + 1) % sampleDatasets.length;
            calculate();
        });

        calculateBtn.addEventListener('click', calculate);

        dataInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.ctrlKey) {
                calculate();
            }
        });

        // Calculate on load
        calculate();
    </script>
</body>

</html>